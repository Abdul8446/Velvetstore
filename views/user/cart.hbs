{{#if cartCount}}
<!--================Categories Banner Area =================-->
<section class="solid_banner_area">
    <div class="container">
        <div class="solid_banner_inner">
            <h3>shopping cart 02</h3>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="shopping-cart2.html">Shopping cart 02</a></li>
            </ul>
        </div>
    </div>
</section>
<!--================End Categories Banner Area =================-->

<!--================Shopping Cart Area =================-->

<section class="shopping_cart_area p_100">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <div class="cart_items">
                    <h3>Your Cart Items</h3>
                    <div class="table-responsive-md">
                        <table class="table">
                            <tbody>
                                {{#each products}}
                                <tr>
                                    <th scope="row">
                                        <button class="border-0 bg-white"
                                            onclick="deleteCartProduct('{{this._id}}','{{this.product._id}}','{{this.quantity}}')"><img
                                                src="img/icon/close-icon.png" alt=""></button>
                                    </th>
                                    {{!-- {{#each this.product}} --}}
                                    <td>
                                        <div class="media">
                                            <div class="d-flex">
                                                <img src="/images/product/{{this.product.img.[0]}}" height="120px"
                                                    width="100px" alt="">
                                            </div>
                                            <div class="media-body">
                                                <h4>{{this.product.name}}</h4>
                                            </div>
                                        </div>
                                    </td>
                                    {{!-- {{/each}} --}}
                                    <td>
                                        {{#if this.product.discount.status}}
                                        {{#if this.product.subCatDiscount.status}}
                                        {{#when this.product.subCatDiscount.percent 'gteq'
                                        this.product.discount.percent}}
                                        <p class="red">₹{{../this.product.subCatOfferPrice}}</p>
                                        {{else}}
                                        <p class="red">₹{{../this.product.offerPrice}}</p>
                                        {{/when}}
                                        {{else}}
                                        <p class="red">₹{{this.product.offerPrice}}</p>
                                        {{/if}}
                                        {{else}}
                                        {{#if this.product.subCatDiscount.status}}
                                        <p class="red">₹{{this.product.subCatOfferPrice}}</p>
                                        {{else}}
                                        <p class="red">₹{{this.product.MRP}}</p>
                                        {{/if}}
                                        {{/if}}
                                    </td>
                                    <td>
                                        <div class="quantity">
                                            <h6>Quantity</h6>
                                            <div class="custom">
                                                <button class="border-0 bg-white"
                                                    onclick="changeQuantity('{{../user._id}}','{{this._id}}','{{this.product._id}}',-1)">-</button>
                                                <span id="{{this.product._id}}">{{this.quantity}}</span>
                                                <button class="border-0 bg-white"
                                                    onclick="changeQuantity('{{../user._id}}','{{this._id}}','{{this.product._id}}',1)">+</button>
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        {{#if this.product.discount.status}}
                                        {{#if this.product.subCatDiscount.status}}
                                        {{#when this.product.subCatDiscount.percent 'gteq'
                                        this.product.discount.percent}}
                                        <p>{{../this.totalSubCatOfferPrice}}</p>
                                        {{else}}
                                        <p>{{../this.totalOfferPrice}}</p>
                                        {{/when}}
                                        {{else}}
                                        <p>{{this.totalOfferPrice}}</p>
                                        {{/if}}
                                        {{else}}
                                        {{#if this.product.subCatDiscount.status}}
                                        <p>{{this.totalSubCatOfferPrice}}</p>
                                        {{else}}
                                        <p>{{this.totalMRP}}</p>
                                        {{/if}}
                                        {{/if}}
                                    </td>
                                </tr>
                                {{/each}}
                                <tr>
                                    <th scope="row">
                                    </th>
                                </tr>
                                {{!-- <tr class="last">
                                    <th scope="row">
                                        <img src="img/icon/cart-icon.png" alt="">
                                    </th>
                                    <td>
                                        <div class="media">
                                            <div class="d-flex">
                                                <h5>Cupon code</h5>
                                            </div>
                                            <div class="media-body">
                                                <input type="text" placeholder="Apply cuopon">
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        <p class="red"></p>
                                    </td>
                                    <td>
                                        <h3>update cart</h3>
                                    </td>
                                    <td></td>
                                </tr> --}}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-lg-4">
                <div class="cart_totals_area">
                    <h4>Cart Totals</h4>
                    <div class="cart_t_list">
                        <div class="media">
                            <div class="d-flex">
                                <h5>Subtotal</h5>
                            </div>
                            <div class="media-body">
                                <h6>₹{{totalValue}}</h6>
                            </div>
                        </div>
                        <div class="media">
                            <div class="d-flex">
                                <h5>Shipping</h5>
                            </div>
                            <div class="media-body">
                                <p>Free Shipping</p>
                            </div>
                        </div>
                        <div class="media">
                            <div class="d-flex">

                            </div>
                            {{!-- <div class="media-body">
                                <select class="selectpicker">
                                    <option>Calculate Shipping</option>
                                    <option>Calculate Shipping</option>
                                    <option>Calculate Shipping</option>
                                </select>
                            </div> --}}
                        </div>
                    </div>
                    <div class="total_amount row m0 row_disable">
                        <div class="float-left">
                            Total
                        </div>
                        <div class="float-right">
                            ₹<span id="totalValue">{{totalValue}}</span>
                        </div>
                    </div>
                </div>
                <a href="/checkout"><button type="submit" value="submit" class="btn subs_btn form-control">Proceed to
                        checkout</button></a>
            </div>
        </div>
    </div>
</section>
<!--================End Shopping Cart Area =================-->
{{else}}
<!--================Categories Banner Area =================-->
<section class="solid_banner_area">
    <div class="container">
        <div class="solid_banner_inner">
            <h3>empty cart</h3>
            <ul>
                <li><a href="#">Home</a></li>
                <li><a href="track.html">empty cart</a></li>
            </ul>
        </div>
    </div>
</section>
<!--================End Categories Banner Area =================-->

<!--================login Area =================-->
<section class="emty_cart_area p_100">
    <div class="container">
        <div class="emty_cart_inner">
            <i class="icon-handbag icons"></i>
            <h3>Your Cart is Empty</h3>
            <h4>back to <a href="#">shopping</a></h4>
        </div>
    </div>
</section>
<!--================End login Area =================-->
{{/if}}

<script>
    function changeQuantity(userId, cartId, prodId, count) {
        let quantity = parseInt(document.getElementById(prodId).innerHTML)
        count = parseInt(count)
        console.log(userId, cartId, prodId, count)

        $.ajax({
            url: '/change-product-quantity',
            data: {
                user: userId,
                cart: cartId,
                product: prodId,
                count: count,
                quantity: quantity
            },
            method: 'post',
            success: (response) => {
                console.log(response)
                if (response.removeProduct) {
                    Swal.fire({
                        position: 'center',
                        icon: 'success',
                        title: 'Product removed from cart',
                        showConfirmButton: false,
                        timer: 1500
                    })
                    location.reload()
                } else {
                    quantity = document.getElementById(prodId).innerHTML = quantity + count
                    document.getElementById('totalValue').innerHTML = response.total[0].total
                }
                location.reload()
            }
        })
    }

    function deleteCartProduct(cartId, prodId, prodQuantity) {
        $.ajax({
            url: '/delete-cart-products',
            method: 'post',
            data: {
                cartId: cartId,
                prodId: prodId,
                prodQuantity: prodQuantity
            },
            success: (response) => {
                if (response.deleteStatus) {
                    Swal.fire({
                        position: 'center',
                        icon: 'success',
                        title: 'Product removed from cart',
                        showConfirmButton: false,
                        timer: 1500
                    })
                    location.reload()
                }
            }
        })
    }

</script>